!function(d3,window,document){function addEvent(obj,type,fn){obj.attachEvent?(obj["e"+type+fn]=fn,obj[type+fn]=function(){obj["e"+type+fn](window.event)},obj.attachEvent("on"+type,obj[type+fn])):obj.addEventListener(type,fn,!1)}function getParent(el,className){for(var parent=null,p=el.parentNode;null!==p;){var o=p;if(o.classList.contains(className)){parent=o;break}p=o.parentNode}return parent}function drawLineChart(data,metric,type){function drawCircle(datum,index,delay){circleContainer.datum(datum).append("circle").attr("class","lineChart--circle").attr("r",0).attr("cx",function(d){return x(d.date)+detailWidth/2}).attr("cy",function(d){return y(d.value[type])}).attr("data-average",function(d){return d.value.average}).attr("data-timestamp",function(d){return+d.date}).attr("data-max",function(d){return d.value.max}).attr("data-median",function(d){return d.value.median}).attr("data-metric",function(){return metric}).attr("data-min",function(d){return d.value.min}).attr("data-sum",function(d){return d.value.sum}).on("mouseenter",function(){d3.select(this).attr("class","lineChart--circle lineChart--circle__highlighted").attr("r",6)}).on("mouseout",function(){d3.select(this).attr("class","lineChart--circle").attr("r",4)}).transition().delay(function(){return void 0===delay?DURATION/10*index:0}).attr("r",4)}function drawCircles(data,delay){circleContainer||(circleContainer=svg.append("g")),circleContainer.selectAll("circle").remove(),data.forEach(function(datum,index){drawCircle(datum,index,delay)})}function tween(b,callback){return function(a){var i=function(){return function(t){return a.map(function(datum,index){var returnObject=datum;return returnObject.value[type]=b[index].value[type]*t,returnObject})}}();return function(t){return callback(i(t))}}}function redraw(){svg.select(".lineChart--xAxis").call(xAxis).selectAll("text").attr("transform","rotate(45)").style("text-anchor","start"),svg.select(".lineChart--xAxisTicks").call(xAxisTicks),svg.select(".p--lineChart--area").attr("d",area),svg.select(".p--lineChart--areaLine").attr("d",line),drawCircles(data,!1)}function zoomed(){redraw(),svg.select(".p--lineChart--reset").attr("class","p--lineChart--reset active"),svg.select(".p--lineChart--resetText").attr("class","p--lineChart--resetText active")}function unZoomed(){zoom.translate([0,0]).scale(1),redraw(),svg.select(".p--lineChart--reset").attr("class","p--lineChart--reset"),svg.select(".p--lineChart--resetText").attr("class","p--lineChart--resetText")}data=data.reduce(function(newData,datum){return datum.metrics[metric]&&newData.push({date:new Date(datum.timestamp),value:datum.metrics[metric]}),newData},[]);var circleContainer,zoom,containerEl=document.getElementById("graph--"+metric),width=containerEl.clientWidth,height=.4*width,margin={top:20,right:10,bottom:60,left:10},detailWidth=98,container=d3.select(containerEl),svg=container.select("svg").attr("width",width).attr("height",height+margin.top+margin.bottom).attr("class","p--graphs--svg__initialized"),x=d3.time.scale().range([0,width-detailWidth]),xAxis=d3.svg.axis().scale(x).ticks(8).tickSize(-height),xAxisTicks=d3.svg.axis().scale(x).ticks(16).tickSize(-height).tickFormat(""),y=d3.scale.linear().range([height,0]),yAxisTicks=d3.svg.axis().scale(y).ticks(12).tickSize(width).tickFormat("").orient("right"),area=d3.svg.area().interpolate("linear").x(function(d){return x(d.date)+detailWidth/2}).y0(height).y1(function(d){return y(d.value[type])}),line=d3.svg.line().interpolate("linear").x(function(d){return x(d.date)+detailWidth/2}).y(function(d){return y(d.value[type])}),startData=data.map(function(datum){return{date:datum.date,value:{average:0,min:0,median:0,max:0,sum:0}}});x.domain([data[0].date,data[data.length-1].date]),y.domain([0,d3.max(data,function(d){return d.value?d.value[type]:0})+700]),svg.empty()||svg.selectAll("g, path").remove(),svg.append("g").attr("class","lineChart--xAxisTicks").attr("transform","translate("+detailWidth/2+","+height+")").call(xAxisTicks),svg.append("g").attr("class","lineChart--xAxis").attr("transform","translate("+detailWidth/2+","+(height+5)+")").call(xAxis).selectAll("text").attr("transform","rotate(45)").style("text-anchor","start"),svg.append("g").attr("class","lineChart--yAxisTicks").call(yAxisTicks),svg.append("path").datum(startData).attr("class","p--lineChart--area").attr("d",area).transition().duration(DURATION).attrTween("d",tween(data,area)),svg.append("path").datum(startData).attr("class","p--lineChart--areaLine").attr("d",line).transition().duration(DURATION).delay(DURATION/2).attrTween("d",tween(data,line)).each("end",function(){drawCircles(data)}),zoom=d3.behavior.zoom().x(x).scaleExtent([1,100]).on("zoom",zoomed),svg.append("rect").attr("class","p--lineChart--pane").attr("width",width).attr("height",height).call(zoom),svg.append("rect").attr("class","p--lineChart--reset").attr("width",77).attr("height",23).attr("x",width-77).attr("y",2).on("click",unZoomed),svg.append("text").attr("class","p--lineChart--resetText").attr("x",width-38).attr("y",17).text("reset").on("click",unZoomed)}function appendDetailBoxForCircle(circle){removeDetailBoxForCircle(circle);var bBox=circle.getBBox(),detailBox=document.createElement("div"),listContainer=getParent(circle,"p--graphs--graph");detailBox.innerHTML="<dl><dt>Average:</dt><dd>"+circle.attributes.getNamedItem("data-average").value+"</dd><dt>Max:</dt><dd>"+circle.attributes.getNamedItem("data-max").value+"</dd><dt>Median:</dt><dd>"+circle.attributes.getNamedItem("data-median").value+"</dd><dt>Min:</dt><dd>"+circle.attributes.getNamedItem("data-min").value+"</dd><dt>Sum:</dt><dd>"+circle.attributes.getNamedItem("data-sum").value+"</dd></dl>",detailBox.style.left=bBox.x-71+"px",detailBox.style.top=bBox.y-75+"px",detailBox.classList.add("p--graphs--detailBox"),listContainer.appendChild(detailBox)}function removeDetailBoxForCircle(circle){var listContainer=getParent(circle,"p--graphs--graph"),detailBox=listContainer.querySelector(".p--graphs--detailBox");detailBox&&listContainer.removeChild(detailBox)}function attachCircleEvents(){var mainContainer=document.getElementsByTagName("main")[0];addEvent(mainContainer,"mouseover",function(event){"circle"===event.target.tagName&&(appendDetailBoxForCircle(event.target),highlightTableRow(event.target))}),addEvent(mainContainer,"mouseout",function(event){"circle"===event.target.tagName&&(removeDetailBoxForCircle(event.target),unhighlightTableRow(event.target))})}function attachClickEvents(){var mainContainer=document.getElementsByTagName("main")[0];addEvent(mainContainer,"click",function(event){event.target.classList.contains("js-expand")&&document.getElementById("p--table--container--"+event.target.attributes.getNamedItem("data-metric").value).classList.toggle("expanded")})}function attachDescriptionEvents(){var body=document.querySelector("body");addEvent(body,"mouseover",function(event){if("A"===event.target.tagName&&event.target.classList.contains("active")&&(event.target.classList.contains("p--graphs--descriptionBtn")||event.target.classList.contains("p--graphs--warningBtn")||event.target.classList.contains("p--graphs--experimentalBtn"))){var target=document.getElementById(event.target.href.split("#")[1]);target.removeAttribute("hidden"),event.preventDefault()}}),addEvent(body,"mouseout",function(event){if("A"===event.target.tagName&&event.target.classList.contains("active")&&(event.target.classList.contains("p--graphs--descriptionBtn")||event.target.classList.contains("p--graphs--warningBtn")||event.target.classList.contains("p--graphs--experimentalBtn"))){var target=document.getElementById(event.target.href.split("#")[1]);target.setAttribute("hidden","hidden"),event.preventDefault()}}),addEvent(body,"click",function(event){"A"===event.target.tagName&&(event.target.classList.contains("p--graphs--descriptionBtn")||event.target.classList.contains("p--graphs--warningBtn")||event.target.classList.contains("p--graphs--experimentalBtn"))&&event.preventDefault()})}function attachMetricChangeEvent(){var switcher=document.getElementById("p--switcher");addEvent(switcher,"change",function(event){drawLineCharts(window.results,event.target.value)})}function attachEventListeners(){attachCircleEvents(),attachClickEvents(),attachDescriptionEvents(),attachMetricChangeEvent()}function unhighlightTableRow(target){var row=document.querySelectorAll("#"+target.attributes.getNamedItem("data-metric").value+"--row--"+target.attributes.getNamedItem("data-timestamp").value);row.length&&row[0].classList.remove("active")}function highlightTableRow(target){var metric=target.attributes.getNamedItem("data-metric").value,row=document.getElementById(metric+"--row--"+target.attributes.getNamedItem("data-timestamp").value),scrollContainer=document.getElementById("p--table--container--"+metric);row&&scrollContainer&&(scrollContainer.scrollTop=row.offsetTop,row.classList.add("active"))}function drawLineCharts(data,type){var lastMetric=data[data.length-1];type=type||"median";for(var metric in lastMetric.metrics)lastMetric.metrics[metric]&&"number"==typeof lastMetric.metrics[metric].median&&"timestamp"!==metric&&document.getElementById("graph--"+metric)&&setTimeout(drawLineChart.bind(null,data,metric,type),250)}var DURATION=1500;drawLineCharts(window.results),attachEventListeners()}(d3,window,document);